<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Solr with MySQL | do{coffee; code;} while(true)</title><link rel=canonical href=https://jasonrogena.github.io/posts/2014-10-03-solr-with-mysql/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Solr with MySQL"><meta property="og:description" content="I work in a Research Institute. My job there involves making Software Systems that work with biological sample data. About six months ago, we started developing systems that involved doing high level searches on the biological sample data we have stored in numerous MySQL databases. These high level searches were being done directly on MySQL with the assistance of wildcards and a bit of cleaning. To be honest, the searches weren&rsquo;t really working like we wanted them to."><meta property="og:type" content="article"><meta property="og:url" content="https://jasonrogena.github.io/posts/2014-10-03-solr-with-mysql/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-10-03T00:00:00+00:00"><meta property="article:modified_time" content="2014-10-03T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Solr with MySQL"><meta name=twitter:description content="I work in a Research Institute. My job there involves making Software Systems that work with biological sample data. About six months ago, we started developing systems that involved doing high level searches on the biological sample data we have stored in numerous MySQL databases. These high level searches were being done directly on MySQL with the assistance of wildcards and a bit of cleaning. To be honest, the searches weren&rsquo;t really working like we wanted them to."><link rel=stylesheet href=https://jasonrogena.github.io/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://jasonrogena.github.io/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/tags>Tags</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://jasonrogena.github.io/posts/2014-01-18-kannel-and-the-huawei-e160/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i></a></li><li><a class=icon href=https://jasonrogena.github.io/posts/2014-10-13-simple-localization-on-android/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle()" onmouseout="$('#i-next').toggle()"></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f&text=Solr%20with%20MySQL" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f&title=Solr%20with%20MySQL" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f&is_video=false&description=Solr%20with%20MySQL" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Solr%20with%20MySQL&body=Check out this article: https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f&title=Solr%20with%20MySQL" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f&title=Solr%20with%20MySQL" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f&name=Solr%20with%20MySQL&description=I%20work%20in%20a%20Research%20Institute.%20My%20job%20there%20involves%20making%20Software%20Systems%20that%20work%20with%20biological%20sample%20data.%20About%20six%20months%20ago%2c%20we%20started%20developing%20systems%20that%20involved%20doing%20high%20level%20searches%20on%20the%20biological%20sample%20data%20we%20have%20stored%20in%20numerous%20MySQL%20databases.%20These%20high%20level%20searches%20were%20being%20done%20directly%20on%20MySQL%20with%20the%20assistance%20of%20wildcards%20and%20a%20bit%20of%20cleaning.%20To%20be%20honest%2c%20the%20searches%20weren%26rsquo%3bt%20really%20working%20like%20we%20wanted%20them%20to." aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f&t=Solr%20with%20MySQL" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#my-set-up>My Set Up</a></li><li><a href=#conclusion>Conclusion</a></li></ul></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Solr with MySQL</h1><div class=meta><div class=postdate><time datetime="2014-10-03 00:00:00 +0000 UTC" itemprop=datePublished>2014-10-03</time></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/solr rel=tag>Solr</a>
,
<a class=tag-link href=/tags/mysql rel=tag>MySQL</a></div></div></header><div class=content itemprop=articleBody><p>I work in a Research Institute. My job there involves making Software Systems that work with biological sample data. About six months ago, we started developing systems that involved doing high level searches on the biological sample data we have stored in numerous MySQL databases. These high level searches were being done directly on MySQL with the assistance of wildcards and a bit of cleaning. To be honest, the searches weren&rsquo;t really working like we wanted them to. Some were super slow, others didn&rsquo;t return hits (even the more obvious ones). The cracks really started to show when the size of the datasets on MySQL databases started growing. Something had to be done.</p><p>In comes <a href=lucene.apache.org/solr>Solr</a>&mldr; Well Solr really wasn&rsquo;t the first thing we tried. I played with <a href=www.elasticsearch.org>Elasticsearch</a> and I loved it:</p><ol><li>Elasticsearch is dead simple to deploy. It took me about an hour to come up with something tangible enough to show to my boss.</li><li>It has great plugins. For instance, <a href=http://www.elasticsearch.org/overview/kibana>Kibana</a> for visualizations.</li><li>Elasticsearch is easily scalable over multiple hosts. Scaling was as simple as deploying Elasticsearch in multiple hosts on the same subnet. The hosts automatically discovered each other (what could possibly go wrong).</li><li>Indexing MySQL data is not hard. Well, importing MySQL data might not have been as easy as deploying the Elasticsearch instance but it was close enough.</li></ol><p>I had one major problem with Elasticsearch though. Updating the Elasticsearch index when using MySQL as the source seemed like one big hack. I had to create a bash script that was being called by crontab every 5 minutes or so. The bash scripts first checked for the number of records in the Elasticsearch index, then it checked for the number of rows in an indexed MySQL database and finally, it fetched any new MySQL rows. There were simply too many moving parts. Crontab, files in tmp storing timestamps, updating rivers and streams in <a href=https://github.com/jprante/elasticsearch-river-jdbc>River JDBC</a>&mldr;. It simply wasn&rsquo;t working for me.</p><p>So a few weeks ago I decided to switch to Solr and I must say I&rsquo;m loving it so far:</p><ol><li>No need to install third-party libraries to make it work with MySQL.</li><li>Extremely powerful when it comes to defining the structure of the MySQL datasets.</li><li>Somewhat easy to deploy.</li></ol><p>However, be warned. Solr is not as easy to configure as Elasticsearch. It might take you a day to wrap your head around how it works.</p><blockquote><p><strong>Note:</strong>
I will not explain how to install Solr. Mainly because <a href=http://mjanja.co.ke>somebody else</a> did it for me. There are numerouse posts out there you can use for this. <a href=https://www.digitalocean.com/community/tutorials/how-to-install-solr-on-ubuntu-14-04>Here&rsquo;s</a> one for example. I will also not go through step-by-step configuration of Solr with MySQL. Solr&rsquo;s <a href=http://wiki.apache.org/solr/DataImportHandler>official wiki page</a> for the DataImportHandler is pretty comprehensive on this topic. I will mainly consentate on the odd behaviours in Solr that made configuration a bit time consuming.</p></blockquote><h3 id=my-set-up>My Set Up</h3><p>My setup looks like this:</p><ul><li>The server runs Ubuntu 14.04</li><li>I&rsquo;m using Tomcat7 as the servlet container</li><li>Solr is installed in /usr/share/tomcat7/solr. I&rsquo;ll be calling this <strong>SOLR_HOME</strong></li><li>I have a Solr core called samples in /usr/share/tomcat7/solr/cores/samples</li><li>The samples core&rsquo;s config directory is /usr/share/tomcat7/solr/cores/samples/config</li></ul><p>After installation and configuration, my Solr core home had the following files:</p><ul><li>solrconfig.xml. This file is the main configuration file for you core</li><li>schema.xml. This file basically handles datatypes and associates fields to datatypes</li><li>data-config.xml. This file contains the MySQL queries responsible for importing data from MySQL into Solr.</li></ul><h4 id=1-the-mysql-connector>1. The MySQL Connector</h4><p>Java needs the MySQL <a href=http://dev.mysql.com/downloads/connector/j/5.1.html>Connector Library</a> for it to connect to MySQL. There are two ways you can import the Connector Library into solr.</p><ol><li>Dumping the lib into Tomcat&rsquo;s common class loader directory</li><li>Manually importing the library in your solrconfig.xml file</li></ol><p>If you plan on having more than one core that will import data from MySQL, I&rsquo;d prefer you use the first method. Manually importing the library in each of your cores might lead to Java throwing <a href=http://www.integratingstuff.com/2011/07/24/understanding-and-avoiding-the-java-permgen-space-error/>PermGen Space Errors</a>.</p><h4 id=2-importing-the-necessary-solr-libs>2. Importing the Necessary Solr Libs</h4><p>Solr will need the dataimporthandler library for it to be able to import data from MySQL. I created a directory called <strong>dist</strong> in my SOLR_HOME, copied the solr-dataimporthandler.jar and solr-dataimporthandler-extras.jar from Solr example provided in the installation zip/tarball file into this <strong>dist</strong> directory then pointed my solrconfig.xml files to these libraries:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;lib</span> <span style=color:#a6e22e>dir=</span><span style=color:#e6db74>&#34;../../dist/&#34;</span> <span style=color:#a6e22e>regex=</span><span style=color:#e6db74>&#34;solr-dataimporthandler-\d.*\.jar&#34;</span> <span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;lib</span> <span style=color:#a6e22e>dir=</span><span style=color:#e6db74>&#34;../../dist/&#34;</span> <span style=color:#a6e22e>regex=</span><span style=color:#e6db74>&#34;solr-dataimporthandler-extras-\d.*\.jar&#34;</span> <span style=color:#f92672>/&gt;</span>
</code></pre></div><p>To be safe, I added the lines after the last lib tag in the file.</p><h4 id=3-mysql-authentication-and-datasources>3. MySQL Authentication and Datasources</h4><p>The <a href=https://wiki.apache.org/solr/DataImportHandler>dataimporthandler wiki</a> recommends you define your MySQL datasources in your data-config.xml file. However, this did not work for me. Solr was not able to read the data-config.xml file whenever I did this. I therefore had to move the datasources to the solrconfig.xml file. Here&rsquo;s how the DataImportHandler looks in my solrconfig.xml file:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;requestHandler</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;/handlers&#34;</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;org.apache.solr.handler.dataimport.DataImportHandler&#34;</span><span style=color:#f92672>&gt;</span><span style=color:#75715e>&lt;!-- make sure the is there in the name otherwise this wont work --&gt;</span>
  <span style=color:#f92672>&lt;lst</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;defaults&#34;</span><span style=color:#f92672>&gt;</span>
     <span style=color:#f92672>&lt;str</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;config&#34;</span><span style=color:#f92672>&gt;</span>data-config.xml<span style=color:#f92672>&lt;/str&gt;</span><span style=color:#75715e>&lt;!-- here is where you specify where the schema is  --&gt;</span>
     <span style=color:#f92672>&lt;lst</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;datasource&#34;</span><span style=color:#f92672>&gt;</span>
        <span style=color:#f92672>&lt;str</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>&gt;</span>data_source_0<span style=color:#f92672>&lt;/str&gt;</span>
        <span style=color:#f92672>&lt;str</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;driver&#34;</span><span style=color:#f92672>&gt;</span>com.mysql.jdbc.Driver<span style=color:#f92672>&lt;/str&gt;</span>
        <span style=color:#f92672>&lt;str</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;url&#34;</span><span style=color:#f92672>&gt;</span>jdbc:mysql://db_host0/db0?zeroDateTimeBehavior=convertToNull<span style=color:#f92672>&lt;/str&gt;</span>
        <span style=color:#f92672>&lt;str</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;user&#34;</span><span style=color:#f92672>&gt;</span>user0<span style=color:#f92672>&lt;/str&gt;</span>
        <span style=color:#f92672>&lt;str</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;password&#34;</span><span style=color:#f92672>&gt;</span>pw0<span style=color:#f92672>&lt;/str&gt;</span>
     <span style=color:#f92672>&lt;/lst&gt;</span>
     <span style=color:#f92672>&lt;lst</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;datasource&#34;</span><span style=color:#f92672>&gt;</span>
        <span style=color:#f92672>&lt;str</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>&gt;</span>data_source_1<span style=color:#f92672>&lt;/str&gt;</span>
        <span style=color:#f92672>&lt;str</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;driver&#34;</span><span style=color:#f92672>&gt;</span>com.mysql.jdbc.Driver<span style=color:#f92672>&lt;/str&gt;</span>
        <span style=color:#f92672>&lt;str</span> <span style=color:#a6e22e>naqme=</span><span style=color:#e6db74>&#34;url&#34;</span><span style=color:#f92672>&gt;</span>jdbc:mysql://db_host1/db1?zeroDateTimeBehavior=convertToNull<span style=color:#f92672>&lt;/str&gt;</span>
        <span style=color:#f92672>&lt;str</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;user&#34;</span><span style=color:#f92672>&gt;</span>user1<span style=color:#f92672>&lt;/str&gt;</span>
        <span style=color:#f92672>&lt;str</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;password&#34;</span><span style=color:#f92672>&gt;</span>pass1<span style=color:#f92672>&lt;/str&gt;</span>
     <span style=color:#f92672>&lt;/lst&gt;</span>
  <span style=color:#f92672>&lt;/lst&gt;</span>
<span style=color:#f92672>&lt;/requestHandler&gt;</span>
</code></pre></div><p>You&rsquo;ll also want to add the <strong>zeroDateTimeBehavior</strong> variable in your MySQL connection URL to cater for MySQL <strong>datetime</strong> columns that have the &lsquo;00:00:0000&rsquo; value. The Java datatype is not able to handle such a value.</p><h4 id=4-my-data-configxml-file>4. My data-config.xml File</h4><p>Here&rsquo;s a simplified version of my data-config.xml file:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;dataConfig&gt;</span>
 <span style=color:#f92672>&lt;document</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;samples&#39;</span><span style=color:#f92672>&gt;</span>
   <span style=color:#f92672>&lt;entity</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;sample&#34;</span>
           <span style=color:#a6e22e>dataSource=</span><span style=color:#e6db74>&#34;data_source_0&#34;</span>
           <span style=color:#a6e22e>pk=</span><span style=color:#e6db74>&#34;sample_id&#34;</span>
           <span style=color:#a6e22e>query=</span><span style=color:#e6db74>&#34;select a.id as sample_id, a.name, a.box_id, b.name as loc
</span><span style=color:#e6db74>                 from samples as a
</span><span style=color:#e6db74>                 left join locations as b on a.loc_id = b.id&#34;</span>
           <span style=color:#a6e22e>preImportDeleteQuery=</span><span style=color:#e6db74>&#34;*:*&#34;</span><span style=color:#f92672>&gt;</span>
     <span style=color:#f92672>&lt;field</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;SAMPLE_ID&#34;</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;sample_id&#34;</span> <span style=color:#f92672>/&gt;</span>
     <span style=color:#f92672>&lt;field</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;NAME&#34;</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;sample_name&#34;</span> <span style=color:#f92672>/&gt;</span>
     <span style=color:#f92672>&lt;field</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;LOC&#34;</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;sample_loc&#34;</span> <span style=color:#f92672>/&gt;</span>
     <span style=color:#f92672>&lt;field</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;BOX_ID&#34;</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;box_id&#34;</span> <span style=color:#f92672>/&gt;</span>
     <span style=color:#f92672>&lt;entity</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;storage_box&#34;</span>
             <span style=color:#a6e22e>dataSource=</span><span style=color:#e6db74>&#34;data_source_1&#34;</span>
             <span style=color:#a6e22e>pk=</span><span style=color:#e6db74>&#34;box_id&#34;</span>
             <span style=color:#a6e22e>onError=</span><span style=color:#e6db74>&#34;continue&#34;</span>
             <span style=color:#a6e22e>query=</span><span style=color:#e6db74>&#34;select id as box_id, a.name as box_name
</span><span style=color:#e6db74>                   from boxes
</span><span style=color:#e6db74>                   where id = &#39;${sample.box_id}&#39;&#34;</span>
             <span style=color:#a6e22e>preImportDeleteQuery=</span><span style=color:#e6db74>&#34;*:*&#34;</span><span style=color:#f92672>&gt;</span>
       <span style=color:#f92672>&lt;field</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;NAME&#34;</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;box_name&#34;</span> <span style=color:#f92672>/&gt;</span>
     <span style=color:#f92672>&lt;/entity&gt;</span>
   <span style=color:#f92672>&lt;/entity&gt;</span>
 <span style=color:#f92672>&lt;/document&gt;</span>
<span style=color:#f92672>&lt;dataConfig&gt;</span>
</code></pre></div><p>Pay special attention on how joined the root entity (sample) with it&rsquo;s child entity (storage_box). I recommend adding the onError attribute to your child entity. Refer to the dataimport WiKi for possible value of this entity. Make sure your parent entity&rsquo;s primary key is surrounded in quotes in the child entity&rsquo;s MySQL query. Do this even if the primary key is an integer. I did this as a form of a failsafe in cases where the primary key is empty.</p><p>Also note that I used joins instead of entities whever I could. Using sub-entities would have improve the performance during importation and indexing. On the other hand, it&rsquo;s simpler to use joins.</p><p>Solr was unable to import the data-config.xml file whenever I put comments in it. This is a bit odd, and maybe I&rsquo;m the one who doesn&rsquo;t know how to comment on xml. My data-config.xml file is therefore free of comments.</p><p>Another issue you should watch out for is Solr will not populate fields that have names that confilct with words reserved by Solr. In my case, Solr was unable to import data for fields named: <strong>&lsquo;feature&rsquo;</strong> and <strong>&lsquo;size&rsquo;</strong>. You should therefore check which of your fields are blank after importing data from MySQL.</p><p>It sucks Solr in most cases keeps quiet whenever it&rsquo;s unable to import the data-config.xml file. One way, however, you can tell if your data-config.xml file has an issue is by checking if you can see the root entity your core&rsquo;s Dataimport page:</p><p><img src=/images/2014-10-03-solr-with-mysql_1.png alt="image showing loaded entities from a successfully imported data-config.xml file"></p><h4 id=5-defining-my-datatypes>5. Defining My Datatypes</h4><p>The last major thing I needed to do was to define my datatypes in the schema.xml file. Note that the default schema.xml has most if not all the datatypes you&rsquo;ll need. Here are the lines I needed to add to make it work with the data-config.xml file above:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;uniqueKey&gt;</span>sample_id<span style=color:#f92672>&lt;/uniqueKey&gt;</span>
<span style=color:#f92672>&lt;field</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;sample_id&#34;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;string&#34;</span> <span style=color:#a6e22e>indexed=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#a6e22e>required=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#a6e22e>stored=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;field</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;sample_name&#34;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;text_general&#34;</span> <span style=color:#a6e22e>indexed=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#a6e22e>stored=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#a6e22e>default=</span><span style=color:#e6db74>&#34;NULL&#34;</span> <span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;field</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;sample_loc&#34;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;text_general&#34;</span> <span style=color:#a6e22e>indexed=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#a6e22e>stored=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#a6e22e>default=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;field</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;box_id&#34;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;string&#34;</span> <span style=color:#a6e22e>indexed=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#a6e22e>stored=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#a6e22e>default=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;field</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;box_name&#34;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;text_general&#34;</span> <span style=color:#a6e22e>indexed=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#a6e22e>stored=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#a6e22e>default=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>/&gt;</span>
</code></pre></div><p>To be on the safe side, you might want to initialize your integer fields with the <strong>&lsquo;string&rsquo;</strong> datatype. This is because Solr will not be able to import null values in fields that are of type <strong>&lsquo;int&rsquo;</strong>.</p><h3 id=conclusion>Conclusion</h3><p>Solr has some undocumented weird behaviours when connected to MySQL. Maybe someone working on Solr will someday read this and clarify on these. However, for now, it&rsquo;s important for me to iterate that <strong>if you have a relational database that is normalized, you&rsquo;re better off going with Solr</strong>. I will, in another post, blog on the optimizations I did (especially in the schema.xml file) to make Solr work well in my setup. Feel free to comment on any mistakes (misinformation or grammatical) that I might have made in this post.</p></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/tags>Tags</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><ul><li><a href=#my-set-up>My Set Up</a></li><li><a href=#conclusion>Conclusion</a></li></ul></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f&text=Solr%20with%20MySQL" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f&title=Solr%20with%20MySQL" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f&is_video=false&description=Solr%20with%20MySQL" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Solr%20with%20MySQL&body=Check out this article: https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f&title=Solr%20with%20MySQL" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f&title=Solr%20with%20MySQL" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f&name=Solr%20with%20MySQL&description=I%20work%20in%20a%20Research%20Institute.%20My%20job%20there%20involves%20making%20Software%20Systems%20that%20work%20with%20biological%20sample%20data.%20About%20six%20months%20ago%2c%20we%20started%20developing%20systems%20that%20involved%20doing%20high%20level%20searches%20on%20the%20biological%20sample%20data%20we%20have%20stored%20in%20numerous%20MySQL%20databases.%20These%20high%20level%20searches%20were%20being%20done%20directly%20on%20MySQL%20with%20the%20assistance%20of%20wildcards%20and%20a%20bit%20of%20cleaning.%20To%20be%20honest%2c%20the%20searches%20weren%26rsquo%3bt%20really%20working%20like%20we%20wanted%20them%20to." aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fjasonrogena.github.io%2fposts%2f2014-10-03-solr-with-mysql%2f&t=Solr%20with%20MySQL" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2021 Jason Rogena</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/tags>Tags</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script><script src=/js/code-copy.js></script></html>