<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>An SRE's Guide to Distributed Consensus, Part 1 | do{coffee; code;} while(true)</title><link rel=canonical href=https://rogena.me/posts/2020-11-07-an-sres-guide-to-distributed-consensus-part-1/><meta name=description content="I am a Site Reliability Engineer currently based in Nairobi. If I'm not on my desk, I'll probably be in the kitchen or gym. I'm also a father of seven (plants). Herein lies, mostly tech-related, exploits in the form of blog posts and projects. Feel free to reach out on email or Twitter if you'd like to chat."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="An SRE's Guide to Distributed Consensus, Part 1"><meta property="og:description" content="This is the first of three posts on distributed consensus in the DevOps world. These posts are based on a presentation I gave to the Nairobi GNU/Linux Users Group. A video of the presentation can be found here.
 Consensus is when a group of individuals comes to an agreement, or a general agreement. A general agreement implies that not all individuals in the group need to agree with the decision."><meta property="og:type" content="article"><meta property="og:url" content="https://rogena.me/posts/2020-11-07-an-sres-guide-to-distributed-consensus-part-1/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-11-07T10:00:00+00:00"><meta property="article:modified_time" content="2020-11-07T10:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="An SRE's Guide to Distributed Consensus, Part 1"><meta name=twitter:description content="This is the first of three posts on distributed consensus in the DevOps world. These posts are based on a presentation I gave to the Nairobi GNU/Linux Users Group. A video of the presentation can be found here.
 Consensus is when a group of individuals comes to an agreement, or a general agreement. A general agreement implies that not all individuals in the group need to agree with the decision."><link rel=stylesheet href=https://rogena.me/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://rogena.me/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/tags>Tags</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://rogena.me/posts/2020-01-24-using-password-manager-with-ssh/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i></a></li><li><a class=icon href=https://rogena.me/posts/2020-11-07-an-sres-guide-to-distributed-consensus-part-2/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle()" onmouseout="$('#i-next').toggle()"></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f&text=An%20SRE%27s%20Guide%20to%20Distributed%20Consensus%2c%20Part%201" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f&title=An%20SRE%27s%20Guide%20to%20Distributed%20Consensus%2c%20Part%201" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f&is_video=false&description=An%20SRE%27s%20Guide%20to%20Distributed%20Consensus%2c%20Part%201" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=An%20SRE%27s%20Guide%20to%20Distributed%20Consensus%2c%20Part%201&body=Check out this article: https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f&title=An%20SRE%27s%20Guide%20to%20Distributed%20Consensus%2c%20Part%201" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f&title=An%20SRE%27s%20Guide%20to%20Distributed%20Consensus%2c%20Part%201" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f&name=An%20SRE%27s%20Guide%20to%20Distributed%20Consensus%2c%20Part%201&description=This%20is%20the%20first%20of%20three%20posts%20on%20distributed%20consensus%20in%20the%20DevOps%20world.%20These%20posts%20are%20based%20on%20a%20presentation%20I%20gave%20to%20the%20Nairobi%20GNU%2fLinux%20Users%20Group.%20A%20video%20of%20the%20presentation%20can%20be%20found%20here.%0a%20Consensus%20is%20when%20a%20group%20of%20individuals%20comes%20to%20an%20agreement%2c%20or%20a%20general%20agreement.%20A%20general%20agreement%20implies%20that%20not%20all%20individuals%20in%20the%20group%20need%20to%20agree%20with%20the%20decision." aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f&t=An%20SRE%27s%20Guide%20to%20Distributed%20Consensus%2c%20Part%201" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#consensus-in-computing>Consensus in Computing</a></li><li><a href=#distributed-consensus>Distributed Consensus</a></li><li><a href=#state-machines>State Machines</a></li></ul></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">An SRE's Guide to Distributed Consensus, Part 1</h1><div class=meta><div class=postdate><time datetime="2020-11-07 10:00:00 +0000 UTC" itemprop=datePublished>2020-11-07</time></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/raft rel=tag>Raft</a>
,
<a class=tag-link href=/tags/distributed-consensus rel=tag>Distributed Consensus</a></div></div></header><div class=content itemprop=articleBody><blockquote><p>This is the first of three posts on distributed consensus in the DevOps world. These posts are based on a presentation I gave to the Nairobi GNU/Linux Users Group. A video of the presentation can be found <a href="https://www.youtube.com/watch?v=oVmitH0-LUQ&t=181s">here</a>.</p></blockquote><p>Consensus is when a group of individuals comes to an agreement, or a general agreement. A general agreement implies that not all individuals in the group need to agree with the decision. As long as most of the individuals have agreed then we can assume that a general consensus was achieved.</p><p><img src=/images/2020-11-07-consensus.jpg alt=consensus></p><h3 id=consensus-in-computing>Consensus in Computing</h3><p>There are several applications for consensus in computing. As an example, if you have several workers that can process queued tasks, the workers will need to reach a consensus on which of them should process a task in the queue to prevent situations where more than one worker processes the same task. This can be achieved by assigning a lock to each task on the queue. The workers then agreed that whichever worker acquires a task&rsquo;s lock first will be responsible for processing that task.</p><p>Consensus in synchronized systems, like the one I have just mentioned, is more often than not, a trivial problem and can be achieved using locks (which are also called mutexes) and semaphores.</p><p>However, consensus in distributed systems is a non-trivial problem due to the nature of distributed systems. Distributed systems are generally assumed to contain independent components (which I&rsquo;ll call nodes) that are connected to each other over the network. It is expected that both the nodes and the network connecting the nodes are prone to failure.</p><p><img src=/images/2020-11-07-distributed-systems-failure.jpg alt="distributed systems failure"></p><h3 id=distributed-consensus>Distributed Consensus</h3><p>The big consensus problem in distributed systems then is; &ldquo;How to achieve consensus when some of the nodes that are expected to agree on something aren&rsquo;t all reachable at the same time but are likely to be reachable at some point in time&rdquo;.</p><p>Because consensus in distributed systems is not a trivial problem to solve, several algorithms have been created to tackle it. Most of these algorithms assume that nodes in a distributed system may fail temporarily or permanently. They also assume that the network connecting the nodes can have varying latencies and that there is a possibility of network partitions (this is where different sections in a network are unable to reach each other for some time).</p><p>The algorithms also assume that nodes in a distributed system might have varying computing power and varying system clocks. You, for example, can have two nodes, A and B, in a distributed system where A is a beefy server and B is a not-so-beefy laptop. A&rsquo;s system clock might be synchronized with an NTP server and B&rsquo;s system clock might not be synchronized with anything at all, and therefore is likely not be accurate.</p><p>&ldquo;What example distributed consensus algorithms exist?&rdquo;, you may ask. Before I answer this question, I&rsquo;ll tell a short story that hopefully will explain a bit why the distributes consensus landscape is what it is today. In 1984, Leslie Lamport (some of us might know him as the the initial developer of LaTeX), in a paper titled &ldquo;Using Time Instead of Timeout for Fault-Tolerant Distributed Systems&rdquo;, defined an approach of solving the distributed consensus problem which he called the state machine replication approach.</p><p>I&rsquo;ll try expound a bit more on what state machines are and what state machine replication entails. Let me first finish the short story.</p><p>In 1989, Lamport came up with the Paxos protocol for distributed consensus. Paxos relies on the state machine replication approach he had presented in 1984. It turns out that several of the most popular distributed consensus algorithms today fall under the Paxos family and maintain some aspects of the original protocol. It&rsquo;s also important for me to state that several other popular, non-Paxos, distributed consensus algorithms also follow the state machine replication approach.</p><p><img src=/images/2020-11-07-paxos-island.jpg alt="Paxos island"></p><p>Fun fact: Paxos is named after the Greek island Paxos. This isn&rsquo;t random really. Lamport, in his 1984 paper, explained the state machine replication approach using an analogy of a fictitious parliament on the island of Paxos that had to function &ldquo;even though legislators continually wandered in and out of the parliamentary Chamber&rdquo;.</p><h3 id=state-machines>State Machines</h3><p>So&mldr; What is a state machine? A state machine is something which when fed a command, changes from one discrete state to another. A good example of a state machine is a database, which if you feed a query, might change from one state to another.</p><p>If you, for instance, run an insert query against a database, the database will change from a state where it didn&rsquo;t have the data inserted using the query to a state where it has this data. In this example, the database is the state machine, and the insert query is a command that changes the database from one state to another.</p><p>Another example of a state machine is a video game. When you feed a video game commands through an input device, like a game pad, the video game changes from a state where, for instance, a character is standing to a state where the character is seated.</p><p>A simpler example of a state machine is a light bulb. When you flip the light bulb&rsquo;s switch up, the bulb transitions from a state where it was off to a state where it is on. When you flip the switch down, the light bulb transitions from a state where it was on to a state where it is off. The act of flipping the switch up or down is the command, in this example and the light bulb (who&rsquo;s state is affected by commands applied on it) is the state machine.</p><p><img src=/images/2020-11-07-state-machine.png alt="state machine"></p><p>The image above is what is called a state machine diagram. It&rsquo;s used to show the different discrete states a state machine can be in as circles. The directional lines connecting the circles represent the commands that transition the state machine from one of its discrete states to another.</p><p>An important characteristic of state machines is, if you feed the machine a sequence of commands, you will always end up in the same state if the number and order of commands is maintained. State machine replication involves sharing commands (intended to be applied to state machines) in a manner that preserves the number and order of these commands. The assumption is that if, for instance, commands are shared amongst 10 individuals, each in possession of the same kind of state machine, after each of the individuals has applied the shared commands on their state machines, all the state machines will be in the exact same state.</p><p>In the state machine replication approach, consensus is achieved when a majority of the nodes agree on the commands to apply against their individual state machines and in what order these commands should be applied.</p><p>In the next post, I will talk about Raft, and how it handles distributed consensus.</p></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/tags>Tags</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><ul><li><a href=#consensus-in-computing>Consensus in Computing</a></li><li><a href=#distributed-consensus>Distributed Consensus</a></li><li><a href=#state-machines>State Machines</a></li></ul></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f&text=An%20SRE%27s%20Guide%20to%20Distributed%20Consensus%2c%20Part%201" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f&title=An%20SRE%27s%20Guide%20to%20Distributed%20Consensus%2c%20Part%201" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f&is_video=false&description=An%20SRE%27s%20Guide%20to%20Distributed%20Consensus%2c%20Part%201" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=An%20SRE%27s%20Guide%20to%20Distributed%20Consensus%2c%20Part%201&body=Check out this article: https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f&title=An%20SRE%27s%20Guide%20to%20Distributed%20Consensus%2c%20Part%201" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f&title=An%20SRE%27s%20Guide%20to%20Distributed%20Consensus%2c%20Part%201" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f&name=An%20SRE%27s%20Guide%20to%20Distributed%20Consensus%2c%20Part%201&description=This%20is%20the%20first%20of%20three%20posts%20on%20distributed%20consensus%20in%20the%20DevOps%20world.%20These%20posts%20are%20based%20on%20a%20presentation%20I%20gave%20to%20the%20Nairobi%20GNU%2fLinux%20Users%20Group.%20A%20video%20of%20the%20presentation%20can%20be%20found%20here.%0a%20Consensus%20is%20when%20a%20group%20of%20individuals%20comes%20to%20an%20agreement%2c%20or%20a%20general%20agreement.%20A%20general%20agreement%20implies%20that%20not%20all%20individuals%20in%20the%20group%20need%20to%20agree%20with%20the%20decision." aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2frogena.me%2fposts%2f2020-11-07-an-sres-guide-to-distributed-consensus-part-1%2f&t=An%20SRE%27s%20Guide%20to%20Distributed%20Consensus%2c%20Part%201" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2021 Jason Rogena</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/tags>Tags</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script><script src=/js/code-copy.js></script></html>